<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>P4P Plugin &mdash; PyDM 1.25.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="External Data Plugins" href="external_plugins.html" />
    <link rel="prev" title="Calc Plugin" href="calc_plugin.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            PyDM
          </a>
              <div class="version">
                1.25.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User &amp; API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../stylesheets.html">Customizing the Look and Feel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help_files.html">Adding Help Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../widgets/index.html">Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../widgets/widget_rules/index.html">Widget Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../add_data_plugins.html">Including Data Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../application.html">Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../channel.html">Channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Plugins</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="local_plugin.html">Local Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="calc_plugin.html">Calc Plugin</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">P4P Plugin</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-types">Supported Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nttables">NTTables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-decompression">Image decompression</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rpc">RPC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="external_plugins.html">External Data Plugins</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers Corner</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/development.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/external_tools.html">External Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../widgets/widget_rules/customizing.html">Customizing Properties for Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/designer_widgets.html">Designer Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/resources.html">Recommended Resources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/slaclab/pydm">PyDM GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/slaclab">SLAC-wide GitHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyDM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">P4P Plugin</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/data_plugins/p4p_plugin.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="p4p-plugin">
<h1>P4P Plugin<a class="headerlink" href="#p4p-plugin" title="Permalink to this heading"></a></h1>
<p>The P4P data plugin is defined in <code class="docutils literal notranslate"><span class="pre">pydm/data_plugins/p4p_plugin_component.py</span></code> and supports the pvAccess
protocol using the <a class="reference external" href="https://mdavidsaver.github.io/p4p/">P4P package</a>.</p>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>The P4P plugin is the default pvAccess plugin, so any address using the “pva://” protocol will be
routed to it as in the example below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pva</span><span class="p">:</span><span class="o">//</span><span class="n">MTEST</span><span class="p">:</span><span class="n">Voltage</span><span class="p">:</span><span class="n">LI30</span>
</pre></div>
</div>
<p>P4P is not currently specified as a required package of PyDM, and as such, will not be automatically included
alongside PyDM when installing it into an environment. P4P must therefore be installed manually. The versions
on conda-forge and PyPI are both supported, so feel free to choose whichever is most convenient:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">p4p</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">p4p</span>
</pre></div>
</div>
<p>The choice of plugin to use can be controlled with the <code class="docutils literal notranslate"><span class="pre">PYDM_PVA_LIB</span></code> environment variable. As of now
P4P is the only option (and will be chosen automatically if this variable is not set) but more may be added
in the future.</p>
<section id="supported-types">
<h3>Supported Types<a class="headerlink" href="#supported-types" title="Permalink to this heading"></a></h3>
<p>Currently this data plugin supports all <a class="reference external" href="https://github.com/epics-base/normativeTypesCPP/wiki/Normative+Types+Specification">normative types</a>. The values and control variables are pulled out of
the data received and sent through the existing PyDM signals to be read by widgets via the channels they are
connected to.</p>
<p>In order to support compatibility with all existing signals and widgets, full structured data support is not
currently possible in this version of the plugin. For example, defining a group PV using Q:Group will not
result in the named fields being sent to the widgets. Full support for structured data is planned to be supported
as part of a future release.</p>
</section>
</section>
<section id="nttables">
<h2>NTTables<a class="headerlink" href="#nttables" title="Permalink to this heading"></a></h2>
<p>The plugin accepts NTTables. It will convert NTTables in python dictionaries which are then passed to the pydm widgets.
Not all widgets will accept a dictionary (or the whole NTTable) as an input.
A specified section of the NTTable can be passed to a those pydm widgets which do not accept dictionaries.
If the PV is passing an NTTable and the user wants to pass only a specific subfield of the NTTable this can be achieved via appending a <code class="docutils literal notranslate"><span class="pre">/</span></code>
followed by the key or name of the column header of the subfield of the NTTable.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pva</span><span class="p">:</span><span class="o">//</span><span class="n">MTEST</span><span class="o">/</span><span class="n">subfield</span>
</pre></div>
</div>
<p>multiple layers of subfields also works:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pva</span><span class="p">:</span><span class="o">//</span><span class="n">MTEST</span><span class="o">/</span><span class="n">sub</span><span class="o">-</span><span class="n">field</span><span class="o">/</span><span class="n">subfield_of_a_subfield</span>
</pre></div>
</div>
<p>Note: subfields can be used to read and write to a subset of data from a NTTable
so long as the type of the subset of data is accepted by the widget in question.</p>
</section>
<section id="image-decompression">
<h2>Image decompression<a class="headerlink" href="#image-decompression" title="Permalink to this heading"></a></h2>
<p>Image decompression is performed when image data is specified using an <code class="docutils literal notranslate"><span class="pre">NTNDArray</span></code> with the <code class="docutils literal notranslate"><span class="pre">codec</span></code> field set.
The decompression algorithm to apply will be determined by what the <code class="docutils literal notranslate"><span class="pre">codec</span></code> field is set to. In order
for decompression to happen, the python package for the associated codec must be installed in the environment
PyDM is running in. Since we do not want to require all of these packages to be installed alongside PyDM when they
may not all be used in many cases, they must be installed manually as needed in the same way as P4P. Each package
is available on both conda-forge and PyPI and may be installed from either.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Pillow</span> <span class="p">(</span><span class="k">for</span> <span class="n">jpeg</span><span class="p">),</span> <span class="n">blosc</span><span class="p">,</span> <span class="n">lz4</span><span class="p">,</span> <span class="n">bitshuffle</span> <span class="p">(</span><span class="k">for</span> <span class="n">bslz4</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading"></a></h2>
<p>A small pva testing ioc is included under <code class="docutils literal notranslate"><span class="pre">examples/testing/pva_testing_ioc.py</span></code>. This can be run in order to
generate a couple of test PVs, which can be connected to using the example .ui file under
<code class="docutils literal notranslate"><span class="pre">examples/pva/pva.ui</span></code>.</p>
</section>
<section id="rpc">
<h2>RPC<a class="headerlink" href="#rpc" title="Permalink to this heading"></a></h2>
<p>The P4P data plugin also supports <strong>remote method calls</strong> (RPC) addresses.</p>
<p>RPC addresses allow for calling methods on a target IOC, and receiving back the method’s result.
RPC addresses must contain arguments matching the name and data-type of those defined in the target’s method.
These arguments are static and set in the widget’s channel address.</p>
<p>RPCs can be set using a pva address in the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pva://&lt;address&gt;?&lt;arg_1_name&gt;=&lt;arg_1_value&gt;&amp;&lt;arg_2_name&gt;=&lt;arg_2_value&gt;&amp;...(pydm_pollrate=&lt;poll_rate_float&gt;)
</pre></div>
</div>
<p>“pydm_pollrate” is an optional parameter, but when included must be placed after the arg name/value pairs in the address.
When “pydm_pollrate” is not used, the last arg name/value pair must still end with a “&amp;” character.
(when not used, the RPC will be called once and not be polled)</p>
<p>Arguments are also optional. When not used, end the address with the “&amp;” character (followed by the optional “pydm_pollrate”):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pva</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">address</span><span class="o">&gt;&amp;</span><span class="p">(</span><span class="n">pydm_pollrate</span><span class="o">=&lt;</span><span class="n">poll_rate_float</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example RPC addresses:</p>
<blockquote>
<div><p>pva://my_address?arg1=value1&amp;
pva://my_address?arg1=value1&amp;arg2=value2&amp;pydm_pollrate=10.5
pva://KLYS:LI12:11:ATTN_CUR&amp;
pva://KLYS:LI12:11:ATTN_CUR&amp;pydm_pollrate=2.0</p>
</div></blockquote>
<p>Additional examples of using RPCs with PyDMLabels are provided in <code class="docutils literal notranslate"><span class="pre">examples/rpc/rpc_labels.py</span></code>.
To run examples, first make sure <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">examples/testing_ioc/rpc_testing_ioc.py</span></code> is actively
running in another terminal.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="calc_plugin.html" class="btn btn-neutral float-left" title="Calc Plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="external_plugins.html" class="btn btn-neutral float-right" title="External Data Plugins" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, hhslepicka, trendahl, zlentz, yektay, nstelter.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>